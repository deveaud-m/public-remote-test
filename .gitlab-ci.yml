image: docker.siemens.com/code-ops/poetry-docker:1.1-py3.9

variables:
    http_proxy: $CODE_PROXY
    https_proxy: $CODE_PROXY
    no_proxy: code.siemens.com,docker.siemens.com
    POETRY_HTTP_BASIC_MKDOCS_USERNAME: gitlab-ci-token
    POETRY_HTTP_BASIC_MKDOCS_PASSWORD: $CI_JOB_TOKEN

# Deploy external website
gh-pages:
    rules:
        - if: $CI_COMMIT_BRANCH == "deploy"
    variables:
        PUBLIC_ORIGIN: "https://deveaud-m:$GITHUB_REPOSITORY_TOKEN@github.com/deveaud-m/public-remote-test.git"
    before_script:
        - git config --global user.email "marion.deveaud@siemens.com"
        - git config --global user.name "Marion Deveaud"
        - poetry install --no-root -n
    script:
        - ./deploy_gh_pages.sh
